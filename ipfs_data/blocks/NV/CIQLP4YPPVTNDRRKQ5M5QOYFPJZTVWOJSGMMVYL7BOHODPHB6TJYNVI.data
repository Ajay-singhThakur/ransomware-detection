"use strict";(self.webpackChunkipfs_webui=self.webpackChunkipfs_webui||[]).push([[701],{1913:(e,t,s)=>{s.d(t,{B:()=>d,U:()=>m});var r=s(37566),n=s(65043),a=s(12820),o=s(27463),l=s(70579);function i(e,t){switch(t.type){case"FETCH_START":return(0,r.A)((0,r.A)({},e),{},{isLoading:!0,hasError:!1});case"FETCH_SUCCESS":return(0,r.A)((0,r.A)({},e),{},{identity:t.payload.identity,isLoading:!1,hasError:!1,lastSuccess:t.payload.timestamp});case"FETCH_ERROR":return(0,r.A)((0,r.A)({},e),{},{isLoading:!1,hasError:!0});default:return e}}const c={identity:void 0,isLoading:!1,hasError:!1,lastSuccess:void 0},u=(0,n.createContext)(void 0);u.displayName="IdentityContext";function d(){const e=(0,n.useContext)(u);if(void 0===e)throw new Error("useIdentity must be used within an IdentityProvider");return e}const m=e=>{var t;let{children:s}=e;const[r,d]=(0,n.useReducer)(i,c),m=(0,o.O0)("selectIsNodeInfoOpen")||!1,h=(0,o.O0)("selectIpfsConnected")||!1,g=(0,o.O0)("selectIpfs"),f=(0,n.useRef)(r.identity);(0,n.useEffect)((()=>{r.identity&&(f.current=r.identity)}),[r.identity]);const p=null!==(t=r.identity)&&void 0!==t?t:f.current,b=null==p&&r.isLoading,x=null!=p&&r.isLoading,v=(0,n.useCallback)((async()=>{if(h&&g)try{d({type:"FETCH_START"});const e=await g.id();d({type:"FETCH_SUCCESS",payload:{identity:e,timestamp:Date.now()}})}catch(e){console.error("Failed to fetch identity:",e),d({type:"FETCH_ERROR"})}}),[g,h]);(0,n.useEffect)((()=>{h&&!r.isLoading&&(r.identity&&r.lastSuccess||v())}),[h,v,r.isLoading,r.identity,r.lastSuccess]),(0,n.useEffect)((()=>{if(!m||!h||!r.lastSuccess)return()=>{};const e=Date.now()-r.lastSuccess;if(e<5e3){const t=setTimeout(v,5e3-e);return()=>clearTimeout(t)}return v(),()=>{}}),[m,h,r.lastSuccess,v]);const w=(0,n.useMemo)((()=>null==(null===p||void 0===p?void 0:p.agentVersion)?null:(0,a.$)(p.agentVersion)),[p]),y=(0,n.useMemo)((()=>({identity:p,isLoading:b,isRefreshing:x,hasError:r.hasError,lastSuccess:r.lastSuccess,refetch:v,agentVersionObject:w})),[p,b,x,r.hasError,r.lastSuccess,v,w]);return(0,o.OG)("identity",y),(0,l.jsx)(u.Provider,{value:y,children:s})}},6454:(e,t,s)=>{s.d(t,{A:()=>u});var r=s(65043),n=s(16470),a=s(27463),o=s(30446),l=s(39909),i=s(70579);const c=e=>null==e?"":"string"===typeof e?e:JSON.stringify(e),u=e=>{let{checkValidAPIAddress:t=l.v0}=e;const{t:s}=(0,n.Bd)("app"),u=(0,a.O0)("selectIpfsApiAddress"),d=(0,a.O0)("selectIpfsInitFailed"),m=(0,a.O0)("doUpdateIpfsApiAddress"),[h,g]=(0,r.useState)(c(u)),f=!t(h),[p,b]=(0,r.useState)(f||d),[x,v]=(0,r.useState)(f);(0,r.useEffect)((()=>{b(d)}),[x,d]),(0,r.useEffect)((()=>{const e=t(h);v(e),b(!e)}),[h,t]);const[w,y]=(0,r.useState)(!1),j=(0,r.useCallback)((async e=>{if(e.preventDefault(),null!=m&&!w){y(!0);try{await m(h)}finally{y(!1)}}}),[m,h,w]),A=(0,r.useCallback)((e=>{"Enter"!==e.key||w||j(e)}),[j,w]);return(0,i.jsxs)("form",{onSubmit:j,children:[(0,i.jsx)("input",{id:"api-address","aria-label":s("terms.apiAddress"),placeholder:s("apiAddressForm.placeholder"),type:"text",className:"w-100 lh-copy monospace f5 pl1 pv1 mb2 charcoal input-reset ba b--black-20 br1 ".concat(p?"focus-outline-red b--red-muted":"focus-outline-green b--green-muted"),onChange:e=>g(e.target.value),onKeyDown:A,value:h}),(0,i.jsx)("div",{className:"tr",children:(0,i.jsx)(o.A,{minWidth:100,className:"mt2 mt0-l ml2-l tc",disabled:!x||h===u||w,children:s("actions.submit")})})]})}},10951:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(37566),n=(s(65043),s(70579));const a=e=>(0,n.jsxs)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"},e),{},{children:[(0,n.jsx)("path",{d:"M52 18.81A31.19 31.19 0 1 0 83.19 50 31.22 31.22 0 0 0 52 18.81m0 59.78A28.59 28.59 0 1 1 80.59 50 28.63 28.63 0 0 1 52 78.59"}),(0,n.jsx)("path",{d:"M66.33 40.3a.75.75 0 0 0-.22-.53l-3.88-3.88a.74.74 0 0 0-1.06 0L52 45.06l-9.17-9.17a.74.74 0 0 0-1.06 0l-3.88 3.88a.75.75 0 0 0 0 1.06L47.06 50l-9.17 9.17a.75.75 0 0 0 0 1.06l3.88 3.88a.74.74 0 0 0 1.06 0L52 54.94l9.17 9.17a.74.74 0 0 0 .53.22.73.73 0 0 0 .53-.22l3.88-3.88a.75.75 0 0 0 0-1.06L56.94 50l9.17-9.17a.75.75 0 0 0 .22-.53m-11 9.17a.75.75 0 0 0 0 1.06l9.17 9.17-2.8 2.82-9.17-9.17a.75.75 0 0 0-1.06 0l-9.17 9.17-2.82-2.82 9.17-9.17a.75.75 0 0 0 0-1.06l-9.17-9.17 2.82-2.82 9.17 9.17a.75.75 0 0 0 1.06 0l9.17-9.17 2.82 2.82z"})]}))},12820:(e,t,s)=>{s.d(t,{$:()=>a});const r={kubo:{url:"https://github.com/ipfs/kubo"}},n=e=>{const t=r[e];return t?t.url:null};function a(e){const t=e.split("/").filter((e=>!!e)),s=t[0],r=n(s);return{name:s,version:t[1],suffix:t.slice(2).join("/"),url:r}}},18354:(e,t,s)=>{function r(e){var t,s,r,a=2;for("undefined"!=typeof Symbol&&(s=Symbol.asyncIterator,r=Symbol.iterator);a--;){if(s&&null!=(t=e[s]))return t.call(e);if(r&&null!=(t=e[r]))return new n(t.call(e));s="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function n(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return n=function(e){this.s=e,this.n=e.next},n.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var s=this.s.return;return void 0===s?Promise.resolve({value:e,done:!0}):t(s.apply(this.s,arguments))},throw:function(e){var s=this.s.return;return void 0===s?Promise.reject(e):t(s.apply(this.s,arguments))}},new n(e)}s.d(t,{A:()=>r})},55150:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(37566),n=(s(65043),s(70579));const a=e=>(0,n.jsx)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"},e),{},{children:(0,n.jsx)("path",{d:"M76.53 44.5a12.8 12.8 0 0 0-3.81.57 14.07 14.07 0 0 0-13.88-13.3 13.7 13.7 0 0 0-9.12 3.49 17 17 0 0 0-14.78-8.67A17.25 17.25 0 0 0 18 42 14.84 14.84 0 0 0 6.33 56.6c0 13.89 11.56 16.81 13.84 16.81h56.2c5.21 0 12.47-7.37 12.47-14.62 0-7.03-4.61-14.29-12.31-14.29m-.16 25.91H20.22c-.11 0-10.89-1.26-10.89-13.81a11.89 11.89 0 0 1 8-11.32C19.046 44.687 21 45 21 45v-2.25a14 14 0 0 1 27-4.29l1 2.32 1.58-1.94a10.8 10.8 0 0 1 8.36-4 11.1 11.1 0 0 1 7.686 3.37c2.021 2.088 2.497 4.573 3.124 7.79.265 1.362.25 2 .4 3.53l1.73-.91a9.86 9.86 0 0 1 4.65-1.16c5.83 0 9.31 5.74 9.31 11.29 0 6.04-6.51 11.66-9.47 11.66"})}))},57768:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(37566),n=(s(65043),s(70579));const a=e=>(0,n.jsxs)("svg",(0,r.A)((0,r.A)({xmlns:"http://www.w3.org/2000/svg",fillRule:"evenodd",clipRule:"evenodd",viewBox:"0 0 150 150"},e),{},{children:[(0,n.jsx)("path",{d:"M27.828 42.536 103 117.707M26.414 43.95l75.172 75.171a2 2 0 1 0 2.828-2.828L29.243 41.121a2.003 2.003 0 0 0-2.829 0 2.003 2.003 0 0 0 0 2.829M91.085 33.9c.502-4.231.789-4.895 2.118-4.9 1.384-.007 26.791 25.852 26.517 26.989-.135.564-2.089 1.369-4.34 1.787-4.069.755-4.158.823-14.162 10.736l-10.067 9.975-.429 6.099c-.576 8.217-1.481 8.235-9.519.197l-6.185-6.184-1.973 1.982-4.78-4.781 1.937-1.936-6.232-6.574c-7.494-7.904-7.401-8.698 1.072-9.186l5.748-.331L90.603 37.96zM61.194 82.871l-1.48 1.48c-8.593 8.593-10.69 11.054-11.609 13.619-.617 1.722-.952 3.3-.746 3.506s1.823-.143 3.593-.777c2.68-.96 4.959-2.902 13.642-11.626l1.397-1.404z"}),(0,n.jsx)("path",{d:"M104 111.536h12.115c11.345 0 20.542-9.197 20.542-20.542v-2.281c0-10.619-8.965-19.034-19.563-18.363a18.4 18.4 0 0 0-4.438.836v-.082l.001-.068c0-1.339-.117-2.65-.34-3.921a22.3 22.3 0 0 0-.973-3.667c-.883.765-1.933 1.75-3.25 3.025.367 1.449.563 2.978.563 4.563v.03l-.001.094-.036 5.515 5.254-1.679a14.4 14.4 0 0 1 3.473-.654c8.294-.525 15.31 6.06 15.31 14.371v2.281c0 9.136-7.406 16.542-16.542 16.542H100zM36.862 58.539a21.35 21.35 0 0 0-2.179 8.43l-.149 3.042-2.972.666c-8.555 1.919-15.005 9.78-14.538 19.139.496 9.926 8.688 17.72 18.626 17.72h50.208l4 4H35.65c-12.069 0-22.019-9.465-22.621-21.52-.568-11.381 7.28-20.915 17.658-23.242a25.36 25.36 0 0 1 3.214-11.195zm6.419-7.723a21.4 21.4 0 0 1 12.876-4.28 21.42 21.42 0 0 1 14.568 5.687l2.83-2.83a25.4 25.4 0 0 0-17.398-6.857 25.4 25.4 0 0 0-15.729 5.427z"})]}))},58247:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(37566),n=s(58160),a=(s(65043),s(89335)),o=s(57768),l=s(70579);const i=["failed"],c=e=>{let{failed:t=!1}=e,s=(0,n.A)(e,i);return t?(0,l.jsx)(o.A,(0,r.A)({},s)):(0,l.jsx)(a.A,(0,r.A)({},s))}},62914:(e,t,s)=>{s.d(t,{A:()=>p});var r=s(65043),n=s(16470),a=s(64600),o=s.n(a),l=s(6454),i=s(10091),c=s(93031),u=s(28253),d=s(27463),m=s(70579);const h="unix",g="windowsPS",f="windowsCMD",p=()=>{const{t:e}=(0,n.Bd)("welcome"),t=(0,d.O0)("selectIsSameOrigin"),[s,a]=(0,r.useState)(h),p=["http://localhost:3000","http://127.0.0.1:5001","https://webui.ipfs.io"],b=window.location.origin,x=-1===p.indexOf(b);return(0,m.jsxs)(i.A,{className:"pv3 ph4 lh-copy charcoal",children:[(0,m.jsxs)("div",{className:"flex flex-wrap items-center",children:[(0,m.jsx)(u.A,{style:{height:76},className:"fill-red mr",role:"presentation"}),(0,m.jsx)("h1",{className:"montserrat fw4 charcoal ma0 f3 red",children:e("app:status.couldNotConnect")})]}),(0,m.jsx)(n.x6,{i18nKey:"notConnected.paragraph1",t:e,children:(0,m.jsxs)("p",{className:"fw6 mb3",children:["Check out the installation guide in the ",(0,m.jsx)("a",{className:"link blue",href:"https://docs.ipfs.tech/install/command-line-quick-start/",target:"_blank",rel:"noopener noreferrer",children:"IPFS Docs"}),", or try these common fixes:"]})}),(0,m.jsxs)("ol",{className:"pl3 pt2",children:[(0,m.jsx)(n.x6,{i18nKey:"notConnected.paragraph2",t:e,children:(0,m.jsx)("li",{className:"mb3",children:"Is your IPFS daemon running? Try starting or restarting Kubo from your terminal:"})}),(0,m.jsxs)(c.A,{title:"Any Shell",children:[(0,m.jsxs)("code",{className:"db",children:[(0,m.jsx)("b",{className:"no-select",children:"$ "}),"ipfs daemon"]}),(0,m.jsx)("code",{className:"db",children:"Initializing daemon..."}),(0,m.jsx)("code",{className:"db",children:"RPC API server listening on /ip4/127.0.0.1/tcp/5001"})]}),!t&&(0,m.jsxs)("div",{children:[(0,m.jsx)(n.x6,{i18nKey:"notConnected.paragraph3",t:e,children:(0,m.jsxs)("li",{className:"mb3 mt4",children:["Is your Kubo RPC API configured to allow ",(0,m.jsx)("a",{className:"link blue",href:"https://github.com/ipfs/ipfs-webui#configure-kubo-rpc-api-cors-headers",children:"cross-origin (CORS) requests"}),"? If not, run these commands and then start your daemon from the terminal:"]})}),(0,m.jsxs)("div",{className:"br1 overflow-hidden",children:[(0,m.jsxs)("div",{className:"f7 mb0 sans-serif charcoal pv1 pl2 bg-black-20 flex items-center overflow-x-auto",children:[(0,m.jsx)("button",{onClick:()=>a(h),className:o()("pointer mr3 ttu tracked",s===h&&"fw7"),children:"Unix & MacOS"}),(0,m.jsx)("button",{onClick:()=>a(g),className:o()("pointer mr3 ttu tracked",s===g&&"fw7"),children:"Windows Powershell"}),(0,m.jsx)("button",{onClick:()=>a(f),className:o()("pointer ttu tracked",s===f&&"fw7"),children:"Windows CMD"})]}),(0,m.jsxs)("div",{className:"bg-black-70 snow pa2 f7 lh-copy monospace nowrap overflow-x-auto",children:[s===h&&(0,m.jsxs)("div",{children:[(0,m.jsxs)("code",{className:"db",children:[(0,m.jsx)("b",{className:"no-select",children:"$ "}),"ipfs config --json API.HTTPHeaders.Access-Control-Allow-Origin '[",x&&'"'.concat(b,'", '),'"',p.join('", "'),"\"]'"]}),(0,m.jsxs)("code",{className:"db",children:[(0,m.jsx)("b",{className:"no-select",children:"$ "}),'ipfs config --json API.HTTPHeaders.Access-Control-Allow-Methods \'["PUT", "POST"]\'']})]}),s===g&&(0,m.jsxs)("div",{children:[(0,m.jsxs)("code",{className:"db",children:[(0,m.jsx)("b",{className:"no-select",children:"$ "}),"ipfs config --json API.HTTPHeaders.Access-Control-Allow-Origin '[",x&&'\\"'.concat(b,'\\", '),'\\"',p.join('\\", \\"'),"\\\"]'"]}),(0,m.jsxs)("code",{className:"db",children:[(0,m.jsx)("b",{className:"no-select",children:"$ "}),'ipfs config --json API.HTTPHeaders.Access-Control-Allow-Methods \'[\\"PUT\\", \\"POST\\"]\'']})]}),s===f&&(0,m.jsxs)("div",{children:[(0,m.jsxs)("code",{className:"db",children:[(0,m.jsx)("b",{className:"no-select",children:"$ "}),'ipfs config --json API.HTTPHeaders.Access-Control-Allow-Origin "[',x&&'"""'.concat(b,'""", '),'"""',p.join('""", """'),'"""]"']}),(0,m.jsxs)("code",{className:"db",children:[(0,m.jsx)("b",{className:"no-select",children:"$ "}),'ipfs config --json API.HTTPHeaders.Access-Control-Allow-Methods "["""PUT""", """POST"""]"']})]})]})]})]}),(0,m.jsx)(n.x6,{i18nKey:"notConnected.paragraph4",t:e,children:(0,m.jsxs)("li",{className:"mt4 mb3",children:["Is your Kubo RPC on a port other than 5001? If your node is configured with a ",(0,m.jsx)("a",{className:"link blue",href:"https://github.com/ipfs/kubo/blob/master/docs/config.md#addresses",target:"_blank",rel:"noopener noreferrer",children:"custom RPC API address"}),", enter it here."]})}),(0,m.jsx)(l.A,{})]})]})}},65701:(e,t,s)=>{s.r(t),s.d(t,{default:()=>de});var r=s(65043),n=s(16470),a=s(70930),o=s(62914),l=s(37566),i=s(10091),c=s(82516),u=s(48900),d=s(30446),m=s(70579);const h=e=>{let{isOpen:t,onClose:s,onConfirm:a,warningType:o,currentRate:l=0}=e;const{t:i}=(0,n.Bd)("diagnostics"),h=(0,r.useMemo)((()=>{switch(o){case"debug-global":return{title:i("logs.warnings.debugGlobal.title"),message:i("logs.warnings.debugGlobal.message"),details:[i("logs.warnings.debugGlobal.detail1"),i("logs.warnings.debugGlobal.detail2"),i("logs.warnings.debugGlobal.detail3")],confirmText:i("logs.warnings.debugGlobal.confirm"),suggestions:[i("logs.warnings.debugGlobal.suggestion1"),i("logs.warnings.debugGlobal.suggestion2"),i("logs.warnings.debugGlobal.suggestion3")]};case"high-rate":return{title:i("logs.warnings.highRate.title"),message:i("logs.warnings.highRate.message",{rate:l.toFixed(1)}),details:[i("logs.warnings.highRate.detail1"),i("logs.warnings.highRate.detail2")],confirmText:i("logs.warnings.highRate.confirm"),suggestions:[i("logs.warnings.highRate.suggestion1"),i("logs.warnings.highRate.suggestion2")]};case"auto-disable":return{title:i("logs.warnings.autoDisable.title"),message:i("logs.warnings.autoDisable.message",{rate:l.toFixed(1)}),details:[i("logs.warnings.autoDisable.detail1"),i("logs.warnings.autoDisable.detail2")],confirmText:i("logs.warnings.autoDisable.confirm"),suggestions:[i("logs.warnings.autoDisable.suggestion1"),i("logs.warnings.autoDisable.suggestion2")]};default:return{title:"Warning",message:"Unknown warning type",details:[],confirmText:"OK",suggestions:[]}}}),[o,i,l]);return null==o?null:(0,m.jsx)(u.A,{show:t,onLeave:s,children:(0,m.jsxs)(c.aF,{onCancel:s,className:"outline-0",children:[(0,m.jsxs)(c.cw,{children:[(0,m.jsxs)("div",{className:"flex items-center mb3",children:[(0,m.jsx)("span",{className:"mr2 f3",children:"\u26a0\ufe0f"}),(0,m.jsx)("h3",{className:"montserrat fw4 charcoal ma0 f4",children:h.title})]}),(0,m.jsx)("p",{className:"charcoal lh-copy mb3",children:h.message}),h.details.length>0&&(0,m.jsxs)("div",{className:"mb3",children:[(0,m.jsx)("h4",{className:"montserrat fw6 charcoal ma0 f5 mb2",children:i("logs.warnings.potentialIssues")}),(0,m.jsx)("ul",{className:"ma0 pl3",children:h.details.map(((e,t)=>(0,m.jsx)("li",{className:"charcoal lh-copy mb1",children:e},t)))})]}),h.suggestions.length>0&&(0,m.jsxs)("div",{className:"mb3",children:[(0,m.jsx)("h4",{className:"montserrat fw6 charcoal ma0 f5 mb2",children:i("logs.warnings.recommendations")}),(0,m.jsx)("ul",{className:"ma0 pl3",children:h.suggestions.map(((e,t)=>(0,m.jsx)("li",{className:"charcoal lh-copy mb1",children:e},t)))})]})]}),(0,m.jsxs)(c.NS,{children:[(0,m.jsx)(d.A,{className:"ma2 tc bg-gray white",onClick:s,children:i("logs.warnings.cancel")}),(0,m.jsx)(d.A,{className:"ma2 tc bg-red white",onClick:()=>{a(),s()},children:h.confirmText})]})]})})};var g=s(18354);const f={memory:1e3,indexedDB:2e5,warnThreshold:100,autoDisableThreshold:500},p={currentRate:0,recentCounts:[],lastCountTime:Date.now(),hasWarned:!1,autoDisabled:!1},b={entries:new Map,isStreaming:!1,storageStats:null,batchTimeout:null,subsystemLevels:{},actualLogLevels:{},isLoadingLevels:!1};function x(){return(0,l.A)((0,l.A)({},b),{},{bufferConfig:(0,l.A)({},f),rateState:(0,l.A)({},p)})}function v(e,t){switch(t.type){case"START_STREAMING":return(0,l.A)((0,l.A)({},e),{},{isStreaming:!0,rateState:(0,l.A)((0,l.A)({},e.rateState),{},{autoDisabled:!1})});case"STOP_STREAMING":return e.batchTimeout&&clearTimeout(e.batchTimeout),(0,l.A)((0,l.A)({},e),{},{isStreaming:!1,batchTimeout:null});case"ADD_BATCH":{const{entries:s,bufferConfig:r}=e,n=r.memory,a=new Map(s);for(const e of t.entries){const t=e.id;a.has(t)||a.set(t,e)}return function(e,t){if(e.size<=t)return;let s=e.size-t;const r=e.keys();for(;s-- >0;){const{value:t,done:s}=r.next();if(s)break;e.delete(t)}}(a,n),(0,l.A)((0,l.A)({},e),{},{entries:a,batchTimeout:null})}case"CLEAR_ENTRIES":return(0,l.A)((0,l.A)({},e),{},{entries:new Map});case"UPDATE_BUFFER_CONFIG":return(0,l.A)((0,l.A)({},e),{},{bufferConfig:(0,l.A)((0,l.A)({},e.bufferConfig),t.config)});case"UPDATE_RATE_STATE":return(0,l.A)((0,l.A)({},e),{},{rateState:(0,l.A)((0,l.A)({},e.rateState),t.rateState)});case"UPDATE_STORAGE_STATS":return(0,l.A)((0,l.A)({},e),{},{storageStats:t.stats});case"SHOW_WARNING":return(0,l.A)((0,l.A)({},e),{},{rateState:(0,l.A)((0,l.A)({},e.rateState),{},{hasWarned:!0})});case"AUTO_DISABLE":return(0,l.A)((0,l.A)({},e),{},{isStreaming:!1,rateState:(0,l.A)((0,l.A)({},e.rateState),{},{autoDisabled:!0})});case"RESET_WARNING":return(0,l.A)((0,l.A)({},e),{},{rateState:(0,l.A)((0,l.A)({},e.rateState),{},{hasWarned:!1})});case"FETCH_LEVELS":return(0,l.A)((0,l.A)({},e),{},{isLoadingLevels:!0});case"UPDATE_LEVELS":return(0,l.A)((0,l.A)({},e),{},{actualLogLevels:t.levels,isLoadingLevels:!1});default:return e}}async function w(e,t){try{return(await e.log.level("*",void 0,{signal:t})).levels}catch(s){throw console.error("Failed to fetch log levels",s),s}}async function y(e,t,s,r){try{await e.log.level(t,s,{signal:r})}catch(n){throw console.error("Failed to set log level for ".concat(t," to ").concat(s),n),n}}function j(e){const t=e;return{timestamp:t.ts,level:t.level,subsystem:t.logger,message:t.msg}}const A={dbName:"ipfs-webui-logs",storeName:"log-entries",maxEntries:1e4,version:1};const S=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.db=null,this.config=void 0,this.initPromise=null,this.trimmingOldEntries=!1,this.config=(0,l.A)((0,l.A)({},A),e)}async init(){return this.initPromise||(this.initPromise=new Promise(((e,t)=>{const s=indexedDB.open(this.config.dbName,this.config.version);s.onerror=()=>{var e;t(new Error("Failed to open IndexedDB: ".concat(null===(e=s.error)||void 0===e?void 0:e.message)))},s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(this.config.storeName)){const e=t.createObjectStore(this.config.storeName,{keyPath:"id",autoIncrement:!0});e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("level","level",{unique:!1}),e.createIndex("subsystem","subsystem",{unique:!1})}}}))),this.initPromise}async appendLogs(e){if(await this.init(),!this.db)throw new Error("Database not initialized");const t=this.db.transaction([this.config.storeName],"readwrite"),s=t.objectStore(this.config.storeName),r=new Promise(((e,s)=>{t.oncomplete=()=>e(),t.onabort=()=>{var e;return s(null!==(e=t.error)&&void 0!==e?e:new Error("Transaction aborted"))},t.onerror=()=>{var e;return s(null!==(e=t.error)&&void 0!==e?e:new Error("Transaction error"))}}));for(const a of e){var n;const e=(0,l.A)((0,l.A)({},a),{},{timestamp:null!==(n=a.timestamp)&&void 0!==n?n:(new Date).toISOString()}),t=s.add(e);t.onerror=()=>{console.error(t.error)}}"function"===typeof t.commit&&t.commit(),await r,this.enforceMaxEntries()}async getRecentLogs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;if(await this.init(),!this.db)throw new Error("Database not initialized");const t=this.db.transaction([this.config.storeName],"readonly"),s=t.objectStore(this.config.storeName).index("timestamp"),r=new Array(Math.max(0,e));let n=r.length-1,a=!1;return new Promise(((e,o)=>{t.onabort=()=>{var e;a||o(null!==(e=t.error)&&void 0!==e?e:new Error("Transaction aborted"))},t.onerror=()=>{var e;a||o(null!==(e=t.error)&&void 0!==e?e:new Error("Transaction error"))};const l=s.openCursor(void 0,"prev");l.onerror=()=>{},l.onsuccess=()=>{const t=l.result;!t||n<0?a||(a=!0,e(r.slice(n+1))):(r[n--]=t.value,t.continue())}}))}async enforceMaxEntries(){if(!this.db||this.trimmingOldEntries)return;const e=this.db.transaction([this.config.storeName],"readwrite").objectStore("log-entries"),t=e.count();return new Promise(((s,r)=>{t.onsuccess=()=>{const n=t.result;if(n<=this.config.maxEntries)return void s();this.trimmingOldEntries=!0;const a=n-this.config.maxEntries,o=e.index("timestamp").openCursor(null,"next");let l=0;o.onsuccess=()=>{const e=o.result;e&&l<a?(e.delete(),l++,e.continue()):s()},o.onerror=()=>r(o.error)},t.onerror=()=>r(t.error)})).finally((()=>{this.trimmingOldEntries=!1}))}async getStorageStats(){if(await this.init(),!this.db)throw new Error("Database not initialized");return new Promise(((e,t)=>{const s=this.db.transaction([this.config.storeName],"readonly").objectStore("log-entries"),r=s.index("timestamp");let n=0,a=null,o=null,l=0;const i=s.count();i.onsuccess=()=>{if(n=i.result,0===n)return void e({totalEntries:0,oldestTimestamp:null,newestTimestamp:null,estimatedSize:0});const s=r.openCursor(null,"next");s.onsuccess=()=>{const i=s.result;i&&(a=i.value.timestamp,l=n*JSON.stringify(i.value).length);const c=r.openCursor(null,"prev");c.onsuccess=()=>{const t=c.result;t&&(o=t.value.timestamp),e({totalEntries:n,oldestTimestamp:a,newestTimestamp:o,estimatedSize:l})},c.onerror=()=>t(c.error)},s.onerror=()=>t(s.error)},i.onerror=()=>t(i.error)}))}async clearAllLogs(){if(await this.init(),!this.db)throw new Error("Database not initialized");return new Promise(((e,t)=>{const s=this.db.transaction([this.config.storeName],"readwrite").objectStore("log-entries").clear();s.onsuccess=()=>e(),s.onerror=()=>t(s.error)}))}updateConfig(e){this.config=(0,l.A)((0,l.A)({},this.config),e),this.initPromise=null,this.db=null}close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}};var C=s(27463);const N=["debug","info","warn","error","dpanic","panic","fatal"];function E(e){if(!e.trim())return[];const t=e.split(","),s=[];let r=null;for(let n=0;n<t.length;n++){const e=t[n].trim();if(e.includes("=")){const t=e.indexOf("="),r=e.substring(0,t).trim(),n=e.substring(t+1).trim();""!==n.trim()&&s.push({subsystem:r,level:n})}else e&&!r&&(r=e)}return r&&s.push({subsystem:"*",level:r}),s}function T(e){if(0===Object.keys(e).length)return null;const t=e["(default)"],s=[t];return Object.entries(e).forEach((e=>{let[r,n]=e;"(default)"!==r&&n!==t&&s.push("".concat(r,"=").concat(n))})),s.join(",")}function k(e,t){const s=e.split(",");let r=0,n=0;for(let m=0;m<s.length;m++){const e=n+s[m].length;if(t<=e){r=m;break}n=e+1}const a=s[r]||"",o=e.substring(0,t),l=e.substring(t),i=a.indexOf("="),c=i>0&&t>n+i;let u=!1;if(i>0){const e=a.substring(i+1).trim(),t=N.some((t=>t.toLowerCase()===e.toLowerCase()));u=e.length>0&&t}else{const e=N.some((e=>e.toLowerCase()===a.trim().toLowerCase()));u=a.trim().length>0&&e}const d=u&&t===n+a.length;return{currentPartIndex:r,currentPartStart:n,currentPart:a,beforeCursor:o,afterCursor:l,isInSubsystemPart:c,isComplete:u,isAtEndOfCompletePart:d}}function L(e){return N.some((t=>t.toLowerCase()===e.toLowerCase()))}var _=s(1913);function D(e,t){const s=e.split("+")[0],r=t.split("+")[0],n=s.split("-")[0],a=r.split("-")[0],o=n.split("."),l=a.split("."),i=Math.max(o.length,l.length);for(let d=0;d<i;d++){var c,u;const e=null!==(c=o[d])&&void 0!==c?c:"",t=null!==(u=l[d])&&void 0!==u?u:"",s=Number(e),r=Number(t),n=!Number.isNaN(s),a=!Number.isNaN(r);if(n&&a){if(s<r)return-1;if(s>r)return 1}else if(d===i-1){if(e<t)return-1;if(e>t)return 1}else if(console.warn("Non-numeric segments in version strings:",e,t),e<t)return-1}return 0}const P=(0,r.createContext)(void 0);P.displayName="LogsContext";const R=e=>{let{children:t}=e;const[s,n]=(0,r.useReducer)(v,void 0,x),[a,o]=(0,r.useState)(!1),i=(0,r.useRef)(null),c=(0,C.O0)("selectIpfs"),u=(0,C.O0)("selectIpfsConnected"),{ok:d}=function(e){const{minimumVersion:t,requiredFlavor:s,requiredAgent:n,cmpVersionStrings:a=D}=e,{agentVersionObject:o}=(0,_.B)();return{ok:(0,r.useMemo)((()=>null!=o&&(null==n||o.name===n)&&(null==s||o.suffix===s)&&a(o.version,t)>=0),[o,t,s,n,a]),parsed:o}}({minimumVersion:"0.37.0",requiredAgent:"kubo"}),h=(0,r.useRef)(!0),f=(0,r.useCallback)((async e=>{const t=await S.getRecentLogs(e);n({type:"ADD_BATCH",entries:t})}),[n]),p=(0,r.useCallback)(((e,t,s)=>{n({type:"UPDATE_RATE_STATE",rateState:{currentRate:e,recentCounts:t}}),null!=s&&n({type:"UPDATE_STORAGE_STATS",stats:s})}),[]),b=(0,r.useCallback)((()=>{var e;n({type:"AUTO_DISABLE"}),null===(e=i.current)||void 0===e||e.abort()}),[]),A=function(e,t,s,n,a){const o=(0,r.useRef)(null),l=(0,r.useRef)([]),i=(0,r.useRef)(Date.now()),c=(0,r.useRef)([]),u=(0,r.useRef)(null),d=(0,r.useRef)(!1),m=(0,r.useCallback)((async()=>{if(0===l.current.length)return;const r=[...l.current];l.current=[],u.current=null;const o=Date.now(),m=Math.floor(o/1e3);c.current=c.current.filter((e=>{let{second:t}=e;return m-t<5}));const h=c.current.find((e=>{let{second:t}=e;return t===m}));h?h.count+=r.length:c.current.push({second:m,count:r.length});const g=c.current.reduce(((e,t)=>{let{count:s}=t;return e+s}),0)/Math.max(c.current.length,1);n&&n(g,[...c.current]),g>t.autoDisableThreshold&&!d.current&&(console.warn("Log rate too high (".concat(g.toFixed(1),"/s), auto-disabling streaming")),d.current=!0,a&&a());try{s.appendLogs(r);try{const e=await s.getStorageStats();n&&n(g,[...c.current],e)}catch(f){console.warn("Failed to update storage stats:",f)}}catch(f){console.warn("Failed to store logs in IndexedDB:",f)}e(r.length),i.current=o}),[e,t,n,a,s]),h=(0,r.useCallback)((e=>{o.current=e.current,d.current=!1,c.current=[],i.current=Date.now()}),[]),g=(0,r.useCallback)((()=>{var e;u.current&&(clearTimeout(u.current),u.current=null),null===(e=o.current)||void 0===e||e.abort(),o.current=null,l.current.length>0&&setTimeout(m,10)}),[m]),f=(0,r.useCallback)((e=>{if(!o.current||o.current.signal.aborted)return;l.current.push(e);const t=l.current.length>=50||Date.now()-i.current>=100;u.current&&(clearTimeout(u.current),u.current=null),u.current=t?window.setTimeout(m,100):window.setTimeout(m,1e3)}),[m]);return(0,r.useEffect)((()=>{const e=o.current;if(!e)return;const t=()=>{u.current&&(clearTimeout(u.current),u.current=null)};return e.signal.onabort=t,t}),[]),{start:h,stop:g,addEntry:f}}(f,s.bufferConfig,S,p,b),N=(0,r.useCallback)((async()=>{if(!u||!c)return;const e=new AbortController;try{n({type:"FETCH_LEVELS"});const t=await w(c,e.signal);n({type:"UPDATE_LEVELS",levels:t})}catch(t){console.error("Failed to fetch log levels:",t),n({type:"UPDATE_LEVELS",levels:{}})}return()=>{e.abort()}}),[c,u]),E=(0,r.useCallback)((async e=>{if(u&&c)try{const t=await async function(e,t,s){try{const r=t.find((e=>{let{subsystem:t}=e;return"*"===t||"(default)"===t})),n=t.filter((e=>{let{subsystem:t}=e;return"*"!==t&&"(default)"!==t}));r&&await y(e,r.subsystem,r.level,s);for(const{subsystem:t,level:a}of n)await y(e,t,a,s);return w(e,s)}catch(r){throw console.error("Failed to set log levels in batch",r),r}}(c,e);n({type:"UPDATE_LEVELS",levels:t})}catch(t){throw console.error("Failed to set log levels in batch:",t),t}}),[c,u]),k=(0,r.useCallback)((async e=>{try{var t,s=!1,r=!1;try{for(var a,o=(0,g.A)(e);s=!(a=await o.next()).done;s=!1){const e=a.value;{var l;if(null!==(l=i.current)&&void 0!==l&&l.signal.aborted)break;const t=j(e);t&&A.addEntry(t)}}}catch(d){r=!0,t=d}finally{try{s&&null!=o.return&&await o.return()}finally{if(r)throw t}}}catch(m){var c,u;if(null===(c=i.current)||void 0===c||!c.signal.aborted)console.error("Log streaming error:",m),null===(u=i.current)||void 0===u||u.abort(),n({type:"STOP_STREAMING"})}}),[A,n]),L=(0,r.useCallback)((()=>{var e;n({type:"STOP_STREAMING"}),null===(e=i.current)||void 0===e||e.abort(),A.stop()}),[A,n]),R=(0,r.useCallback)((async()=>{if(!u||!c)return void console.error("IPFS instance not available");const e=new AbortController;i.current=e,n({type:"START_STREAMING"}),A.start(i);try{await S.init();try{const e=await S.getRecentLogs(s.bufferConfig.memory);e.length>0&&n({type:"ADD_BATCH",entries:e});const t=await S.getStorageStats();n({type:"UPDATE_STORAGE_STATS",stats:t})}catch(t){console.warn("Failed to load recent logs from storage:",t)}const r=c.log.tail({signal:e.signal});if(!r||"function"!==typeof r[Symbol.asyncIterator])throw new Error("Log streaming not supported");k(r)}catch(t){console.error("Failed to start log streaming:",t),L()}}),[u,c,A,s.bufferConfig.memory,k,L]),I=(0,r.useCallback)((async()=>{try{await S.clearAllLogs()}catch(e){console.warn("Failed to clear IndexedDB logs:",e)}n({type:"CLEAR_ENTRIES"})}),[]),O=(0,r.useCallback)((e=>{n({type:"UPDATE_BUFFER_CONFIG",config:e}),null!=e.indexedDB&&S.updateConfig({maxEntries:e.indexedDB})}),[]),M=(0,r.useCallback)((async()=>{try{const e=await S.getStorageStats();n({type:"UPDATE_STORAGE_STATS",stats:e})}catch(e){console.error("Failed to update storage stats:",e)}}),[]),B=(0,r.useCallback)((async()=>{try{await S.init();const e=await S.getRecentLogs(s.bufferConfig.memory);e.length>0&&n({type:"ADD_BATCH",entries:e})}catch(e){console.warn("Failed to load existing log entries:",e)}}),[s.bufferConfig.memory]),F=(0,r.useCallback)((()=>{n({type:"SHOW_WARNING"})}),[]),H=(0,r.useMemo)((()=>s.isLoadingLevels||0===Object.keys(s.actualLogLevels).length?null:T(s.actualLogLevels)),[s.isLoadingLevels,s.actualLogLevels]),V=(0,r.useMemo)((()=>Object.entries(s.actualLogLevels).filter((e=>{let[t]=e;return"(default)"!==t})).map((e=>{let[t,s]=e;return{name:t,level:s||"info"}})).sort(((e,t)=>e.name.localeCompare(t.name)))),[s.actualLogLevels]);(0,r.useEffect)((()=>{S.updateConfig({maxEntries:s.bufferConfig.indexedDB})}),[s.bufferConfig.indexedDB]),(0,r.useEffect)((()=>(h.current=!0,()=>{L(),h.current=!1})),[]),(0,r.useEffect)((()=>{!a&&d&&async function(){if(h.current){try{await S.init()}catch(e){console.warn("Failed to initialize log storage:",e)}h.current&&u&&c&&await Promise.allSettled([N(),M(),B()]).then((()=>{o(!0)}))}}()}),[u,c,N,M,B,a,d]);const z=(0,r.useMemo)((()=>({startStreaming:R,stopStreaming:L,clearEntries:I,setLogLevelsBatch:E,updateBufferConfig:O,fetchLogLevels:N,updateStorageStats:M,loadExistingEntries:B,showWarning:F})),[R,L,I,E,O,N,M,B,F]),U=(0,r.useMemo)((()=>Array.from(s.entries.values())),[s.entries]),W=(0,l.A)((0,l.A)((0,l.A)({},s),z),{},{entries:U,gologLevelString:H,subsystems:V,isAgentVersionSupported:d});return(0,m.jsx)(P.Provider,{value:W,children:t})};function I(){const e=(0,r.useContext)(P);if(void 0===e)throw new Error("useLogs must be used within a LogsProvider");return e}const O=e=>{let{value:t,onChange:s,subsystems:a,disabled:o=!1,placeholder:l="",className:i="",onSubmit:c,error:u,onValidityChange:d,onErrorChange:h}=e;const{t:g}=(0,n.Bd)("diagnostics"),[f,p]=(0,r.useState)(!1),[b,x]=(0,r.useState)(t),[v,w]=(0,r.useState)(0),[y,j]=(0,r.useState)(0),[A,S]=(0,r.useState)(!1),[C,E]=(0,r.useState)(u||""),[T,_]=(0,r.useState)(!1),[D,P]=(0,r.useState)(!1),R=(0,r.useRef)(null),I=(0,r.useRef)(null);(0,r.useEffect)((()=>{E(u||""),null===d||void 0===d||d(!u),null===h||void 0===h||h(u||"")}),[u,d,h]);const O=(0,r.useCallback)((e=>{const t=function(e,t){if(0===e.trim().length)return{isValid:!1,errorKey:"logs.autocomplete.invalidInput",errorParams:{}};const s=e.split(",");let r=!1;for(let n=0;n<s.length;n++){const e=s[n].trim();if(0!==e.length)if(e.includes("=")){const s=e.indexOf("="),r=e.substring(0,s).trim(),n=e.substring(s+1).trim();if(!t.includes(r))return{isValid:!1,errorKey:"logs.autocomplete.invalidSubsystem",errorParams:{subsystem:r,subsystems:t.join(", ")}};if(0===n.length)return{isValid:!1,errorKey:"logs.autocomplete.invalidSubsystemLevel",errorParams:{subsystem:r,subsystems:t.join(", ")}};if(!L(n))return{isValid:!1,errorKey:"logs.autocomplete.invalidLevel",errorParams:{level:n}}}else{if(r)return t.includes(e)?{isValid:!1,errorKey:"logs.autocomplete.invalidSubsystemLevel",errorParams:{subsystem:e,subsystems:t.join(", ")}}:{isValid:!1,errorKey:"logs.autocomplete.invalidSubsystem",errorParams:{subsystem:e,subsystems:t.join(", ")}};if(!L(e))return{isValid:!1,errorKey:"logs.autocomplete.invalidLevel",errorParams:{level:e}};r=!0}}return{isValid:!0,errorKey:"",errorParams:{}}}(e,a.map((e=>e.name)));if(!t.isValid){const e=g(t.errorKey,t.errorParams);return{isValid:!1,errorMessage:"string"===typeof e?e:String(e)}}return{isValid:!0,errorMessage:""}}),[a,g]),M=(0,r.useMemo)((()=>{const e=k(b,v),t=[];if(D||e.isAtEndOfCompletePart||e.isComplete)return[];if(v===b.length){const e=b.split(","),t=e[e.length-1].trim();if(t.includes("=")&&t.substring(t.indexOf("=")+1).trim().length>0){const e=t.substring(t.indexOf("=")+1).trim();if(N.some((t=>t.toLowerCase()===e.toLowerCase())))return[]}}const s=new Set;if(b.split(",").forEach((e=>{const t=e.trim();if(t.includes("=")){const e=t.substring(0,t.indexOf("=")).trim();s.add(e)}})),0===e.currentPartIndex)N.forEach((s=>{s.toLowerCase().includes(e.currentPart.toLowerCase())&&t.push({text:s,type:"global"})}));else{const r=e.currentPart.trim();if(r.includes("=")){const e=r.indexOf("="),s=r.substring(e+1).trim();N.forEach((e=>{e.toLowerCase().includes(s.toLowerCase())&&t.push({text:e,type:"level"})}))}else a.forEach((e=>{e.name.toLowerCase().includes(r.toLowerCase())&&!s.has(e.name)&&t.push({text:e.name,type:"subsystem"})}))}return t}),[b,v,a,D]),B=(0,r.useCallback)((e=>{const t=e.target.value,r=e.target.selectionStart||0;x(t),w(r),j(0),s(t);O(t).isValid?null===d||void 0===d||d(!0):null===d||void 0===d||d(!1)}),[s,O,d]),F=(0,r.useCallback)((e=>{const t=k(b,v),r=b.split(",");if(0===t.currentPartIndex)r[0]=e.text;else{const s=t.currentPart.trim(),n=s.includes("=");if("subsystem"!==e.type||n)if("level"===e.type&&n){const n=s.indexOf("="),a=s.substring(0,n).trim();r[t.currentPartIndex]=a+"="+e.text}else r[t.currentPartIndex]=e.text;else r[t.currentPartIndex]=e.text+"="}const n=r.join(",");x(n),s(n);const a=O(n);if(a.isValid?(E(""),null===d||void 0===d||d(!0)):(E(a.errorMessage),null===d||void 0===d||d(!1)),"subsystem"!==e.type||t.currentPart.includes("="))p(!1),setTimeout((()=>{R.current&&(R.current.focus(),R.current.setSelectionRange(n.length,n.length))}),0);else{const e=n.lastIndexOf("=")+1;S(!0),w(e),setTimeout((()=>{R.current&&(R.current.focus(),R.current.setSelectionRange(e,e)),S(!1)}),10)}}),[b,v,s,O,d]),H=(0,r.useCallback)((async e=>{if("Enter"!==e.key)switch(e.key){case"ArrowDown":e.preventDefault(),j((e=>(e+1)%M.length));break;case"ArrowUp":e.preventDefault(),j((e=>(e-1+M.length)%M.length));break;case"Escape":p(!1)}else{if(e.preventDefault(),f&&M.length>0)return void(M[y]&&F(M[y]));if(c&&!D){var t;const e=O(b);null===d||void 0===d||d(e.isValid),null===(t=R.current)||void 0===t||t.blur(),p(!1),P(!0);try{await c(void 0)}catch(u){console.error("Form submission error:",u),E(u instanceof Error?u.message:"An unknown error occurred")}finally{P(!1)}}}}),[f,M,y,F,c,D,O,d,b]),V=(0,r.useCallback)((()=>{_(!0),setTimeout((()=>{if(R.current){const e=b.length;R.current.setSelectionRange(e,e),w(e)}}),0);k(b,b.length).isAtEndOfCompletePart?p(!1):M.length>0&&p(!0)}),[M.length,b]),z=(0,r.useCallback)((()=>{A||setTimeout((()=>{var e;if(null===(e=R.current)||void 0===e||!e.matches(":focus")){p(!1),_(!1);const e=O(b);e.isValid?(E(""),null===d||void 0===d||d(!0)):(E(e.errorMessage),null===d||void 0===d||d(!1))}}),150)}),[A,O,b,d]);return(0,r.useEffect)((()=>{x(t)}),[t]),(0,r.useEffect)((()=>{R.current&&R.current.setSelectionRange(v,v)}),[v]),(0,r.useEffect)((()=>{const e=k(b,v);D||e.isAtEndOfCompletePart||e.isComplete?p(!1):p(M.length>0&&T)}),[b,v,M.length,T,D]),(0,r.useEffect)((()=>{if(u)return E(u),void(null===h||void 0===h||h(u));const e=O(b),t=M.length>0,s=!T||T&&!t;!e.isValid&&s?(E(e.errorMessage),null===h||void 0===h||h(e.errorMessage)):e.isValid&&(E(""),null===h||void 0===h||h(""))}),[b,M.length,O,T,u,h]),(0,m.jsxs)("div",{className:"relative ".concat(i),children:[(0,m.jsx)("input",{ref:R,type:"text",value:b,onChange:B,onKeyDown:H,onFocus:V,onBlur:z,disabled:o,placeholder:l,className:"input-reset ba pa2 bg-light-gray f6 w-100 code ".concat(C?"b--red-muted focus-outline-red":"b--black-20"),style:{overflowX:"auto",whiteSpace:"nowrap"}}),f&&M.length>0&&(0,m.jsx)("div",{ref:I,className:"absolute top-100 left-0 right-0 bg-white ba b--black-20 shadow-2 z-999 max-h5 overflow-auto",style:{maxHeight:"200px"},children:M.map(((e,t)=>(0,m.jsxs)("div",{className:"z-999 pa2 pointer hover-bg-light-gray ".concat(t===y?"bg-light-blue":""),onClick:()=>F(e),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),F(e))},role:"button",tabIndex:0,children:[(0,m.jsx)("span",{className:"f6",children:e.text}),(0,m.jsxs)("span",{className:"ml2 f7 gray",children:["global"===e.type&&g("logs.autocomplete.globalLevel"),"subsystem"===e.type&&g("logs.autocomplete.subsystem"),"level"===e.type&&g("logs.autocomplete.level")]})]},"".concat(e.text,"-").concat(t))))})]})},M=()=>{const{t:e}=(0,n.Bd)("diagnostics"),{gologLevelString:t,subsystems:s,setLogLevelsBatch:a}=I(),[o,l]=(0,r.useState)(""),[c,u]=(0,r.useState)(!0),[h,g]=(0,r.useState)("");(0,r.useEffect)((()=>{null!==t&&l(t)}),[t]);const f=(0,r.useCallback)((async s=>{if(null===s||void 0===s||s.preventDefault(),c&&o!==t)try{const t=E(o);for(const{subsystem:s,level:r}of t)if(""===r.trim())return void g(e("logs.gologLevel.invalidSubsystemLevel",{subsystem:s}));await a(t)}catch(r){console.error("Failed to save GOLOG_LOG_LEVEL:",r),u(!1)}}),[c,o,t,a,e]),p=(0,r.useCallback)((e=>{e.preventDefault(),null!==t&&(l(t),u(!0))}),[t]),b=(0,r.useCallback)((e=>{e.preventDefault(),l("error"),u(!0)}),[]),x=(0,r.useMemo)((()=>c&&""===h&&T(function(e){const t={},s=e.find((e=>{let{subsystem:t}=e;return"*"===t||"(default)"===t})),r=(null===s||void 0===s?void 0:s.level)||"info";return t["(default)"]=r,e.forEach((e=>{let{subsystem:s,level:n}=e;"*"!==s&&"(default)"!==s&&n!==r&&(t[s]=n)})),t}(E(o)))!==t),[c,o,t,h]);return null===t?(0,m.jsx)(i.A,{className:"mb3 pa4-l pa2",children:(0,m.jsxs)("div",{className:"mb2",children:[(0,m.jsx)("h3",{className:"montserrat fw4 charcoal ma0 f5 mb2",children:e("logs.gologLevel.title")}),(0,m.jsx)("p",{className:"charcoal f6 mb3",children:e("logs.gologLevel.placeholder")}),(0,m.jsxs)("div",{className:"input-reset ba b--black-20 pa2 bg-light-gray f6 charcoal",children:[e("logs.entries.loading"),"..."]})]})}):(0,m.jsx)(i.A,{className:"mb3 pa4-l pa2",children:(0,m.jsxs)("div",{className:"mb2",children:[(0,m.jsx)("h3",{className:"ttu tracked f6 fw4 teal mt0 mb3",children:e("logs.gologLevel.title")}),(0,m.jsx)("p",{children:(0,m.jsx)(n.x6,{i18nKey:"logs.gologLevel.description",t:e,children:(0,m.jsx)("a",{className:"link blue",href:"https://github.com/ipfs/kubo/blob/master/docs/environment-variables.md#golog_log_level",target:"_blank",rel:"noopener noreferrer",children:" "})})}),(0,m.jsxs)("form",{onSubmit:f,children:[(0,m.jsx)(O,{value:o,onChange:l,subsystems:s,placeholder:e("logs.gologLevel.placeholder"),className:"w-100 lh-copy monospace f5 mb2 charcoal input-reset",onSubmit:f,onValidityChange:u,onErrorChange:g}),h&&(0,m.jsx)("div",{className:"f6 red pa2 mb2",children:h}),(0,m.jsxs)("div",{className:"flex flex-column flex-row-ns justify-end",children:[(0,m.jsx)(d.A,{id:"golog-level-default-button",minWidth:100,bg:"bg-charcoal",className:"tc",onClick:b,disabled:"error"===o,children:e("app:actions.default")}),(0,m.jsx)(d.A,{id:"golog-level-cancel-button",minWidth:100,bg:"bg-charcoal",className:"mt2 mt0-ns ml0 ml2-ns tc",disabled:o===t,onClick:p,children:e("app:actions.cancel")}),(0,m.jsx)(d.A,{id:"golog-level-submit-button",minWidth:100,className:"mt2 mt0-ns ml0 ml2-ns tc",onClick:f,disabled:!x,children:e("app:actions.apply")})]})]})]})})},B=()=>{const{t:e}=(0,n.Bd)("diagnostics"),{identity:t,agentVersionObject:s}=(0,_.B)(),a=(0,r.useCallback)((()=>{let e="https://github.com/ipfs/kubo/releases";"kubo"===(null===s||void 0===s?void 0:s.name)&&"desktop"===s.suffix&&(e="https://github.com/ipfs/ipfs-desktop/releases"),window.open(e,"_blank")}),[s]);return null==s?null:(0,m.jsx)(i.A,{className:"pa4 tc",style:{width:"100%"},children:(0,m.jsxs)("div",{className:"mb4",children:[(0,m.jsx)("div",{className:"f1 mb3",children:"\u26a0\ufe0f"}),(0,m.jsx)("h3",{className:"montserrat fw6 charcoal ma0 f4 mb3",children:e("logs.unsupported.title")}),(0,m.jsx)("p",{className:"charcoal-muted f5 lh-copy mb4",children:e("logs.unsupported.description",{version:null===t||void 0===t?void 0:t.agentVersion})}),(0,m.jsxs)("div",{className:"mb4",children:[(0,m.jsx)("h4",{className:"montserrat fw6 charcoal ma0 f5 mb3",children:e("logs.unsupported.upgradeTitle")}),(0,m.jsx)("p",{className:"charcoal-muted f6 lh-copy mb3",children:e("logs.unsupported.upgradeDescription")}),(0,m.jsx)("div",{className:"flex justify-center gap3",children:(0,m.jsx)(d.A,{className:"bg-blue white",onClick:a,children:e("logs.unsupported.downloadKubo")})})]})]})})},F=e=>{let{children:t,text:s,position:n,forceShow:a=!1}=e;const[o,i]=(0,r.useState)(!1),c=()=>i(!0),u=()=>i(!1),d=(0,r.useMemo)((()=>{const e={position:"absolute",zIndex:1e3,wordWrap:"break-word",width:"max-content",maxWidth:"200px"};switch(n){case"top":return(0,l.A)((0,l.A)({},e),{},{bottom:"100%",left:"50%",transform:"translateX(-50%)",marginBottom:"8px"});case"bottom":return(0,l.A)((0,l.A)({},e),{},{top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"8px"});case"left":return(0,l.A)((0,l.A)({},e),{},{right:"100%",top:"50%",transform:"translateY(-50%)",marginRight:"8px"});case"right":return(0,l.A)((0,l.A)({},e),{},{left:"100%",top:"50%",transform:"translateY(-50%)",marginLeft:"8px"})}}),[n]),h=(0,r.useMemo)((()=>{const e={position:"absolute",width:"8px",height:"8px",zIndex:-1};switch(n){case"top":return(0,l.A)((0,l.A)({},e),{},{top:"100%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",borderRadius:"2px 0px 0px"});case"bottom":return(0,l.A)((0,l.A)({},e),{},{bottom:"100%",left:"50%",transform:"translate(-50%, 50%) rotate(45deg)",borderRadius:"0px 0px 2px 0px"});case"left":return(0,l.A)((0,l.A)({},e),{},{left:"100%",top:"50%",transform:"translate(-50%, -50%) rotate(45deg)",borderRadius:"0px 2px 0px 0px"});case"right":return(0,l.A)((0,l.A)({},e),{},{right:"100%",top:"50%",transform:"translate(50%, -50%) rotate(45deg)",borderRadius:"0px 0px 0px 2px"})}}),[n]),g=(0,r.useMemo)((()=>o||a?"db":"dn"),[o,a]);return(0,m.jsxs)("div",{className:"relative",style:{display:"inline-block"},children:[(0,m.jsx)("div",{onMouseOver:c,onMouseLeave:u,onFocus:c,onBlur:u,children:t}),(0,m.jsxs)("div",{style:d,className:"white z-max bg-navy-muted br2 pv2 ph3 f6 lh-copy fw5 absolute sans-serif noselect ".concat(g),children:[(0,m.jsx)("div",{className:"bg-navy-muted db bg-navy-muted absolute",style:h}),s]})]})};s(58247),s(69884);s(28253);s(89001);s(90844);s(7446),s(55538),s(25205),s(52372),s(55183),s(89852);s(62439);s(62591);s(27858),s(89335),s(57768);const H=e=>(0,m.jsx)("svg",(0,l.A)((0,l.A)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"},e),{},{children:(0,m.jsx)("path",{d:"M74.05 50.235c-.07-3.58 1.86-5.85 5.11-7.1-.2-2-2.48-7.45-3.63-8.76-3.11 1.46-6.06 1.23-8.54-1.22s-2.72-5.46-1.26-8.64a29.2 29.2 0 0 0-8.8-3.63c-1.06 3.08-3.12 5-6.35 5.25-3.82.29-6.29-1.69-7.61-5.22a30.1 30.1 0 0 0-8.77 3.67c1.5 3.16 1.3 6.1-1.15 8.6s-5.45 2.76-8.64 1.29a29.3 29.3 0 0 0-3.58 8.79c3.17 1.17 5.11 3.36 5.17 6.74s-1.82 5.84-5.1 7.12a29.2 29.2 0 0 0 3.68 8.71c3.09-1.38 6-1.15 8.42 1.22s2.79 5.33 1.41 8.49a29.7 29.7 0 0 0 8.76 3.57 1.5 1.5 0 0 0 .11-.21 7.19 7.19 0 0 1 13.53-.16c.13.33.28.32.55.25a29.6 29.6 0 0 0 8-3.3 4 4 0 0 0 .37-.25c-1.27-2.86-1.15-5.57.88-7.94 2.44-2.84 5.5-3.26 8.91-1.8a29.2 29.2 0 0 0 3.65-8.7c-3.17-1.22-5.05-3.38-5.12-6.77M50 59.545a8.57 8.57 0 1 1 8.59-8.31 8.58 8.58 0 0 1-8.59 8.31"})}));s(73487),s(27256);s(8429);s(25820);const V=e=>(0,m.jsx)("svg",(0,l.A)((0,l.A)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"},e),{},{children:(0,m.jsx)("path",{d:"M27.43 71.53a9.18 9.18 0 0 0 9 9.37H64a9.18 9.18 0 0 0 9-9.37V34.82H27.43zM74.5 26.58H61.68a1.3 1.3 0 0 0-.16-.39l-3.76-6.38a1.46 1.46 0 0 0-1.25-.71h-13a1.44 1.44 0 0 0-1.24.71l-3.77 6.38a1.3 1.3 0 0 0-.16.39H25.5a1.8 1.8 0 0 0 0 3.59h49a1.8 1.8 0 0 0 0-3.59m-16.11 0H41.61L44.32 22h11.36z"})}));s(10951);s(55150),s(90342),s(95126),s(39566),s(76013),s(48069);s(55334);s(66149);s(71005);s(23986),s(17052);s(8137);s(13711);s(23886),s(22300),s(65021);s(76062),s(22988);s(70154);s(20535);s(39811);const z=e=>(0,m.jsx)("svg",(0,l.A)((0,l.A)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,className:"glyph_expand_svg__lucide glyph_expand_svg__lucide-expand-icon glyph_expand_svg__lucide-expand"},e),{},{children:(0,m.jsx)("path",{d:"m15 15 6 6M15 9l6-6M21 16v5h-5M21 8V3h-5M3 16v5h5M3 21l6-6M3 8V3h5M9 9 3 3"})})),U=e=>(0,m.jsxs)("svg",(0,l.A)((0,l.A)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,className:"glyph_pause_svg__lucide glyph_pause_svg__lucide-pause-icon glyph_pause_svg__lucide-pause"},e),{},{children:[(0,m.jsx)("rect",{width:5,height:18,x:14,y:3,rx:1}),(0,m.jsx)("rect",{width:5,height:18,x:5,y:3,rx:1})]})),W=e=>(0,m.jsx)("svg",(0,l.A)((0,l.A)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,className:"glyph_play_svg__lucide glyph_play_svg__lucide-play-icon glyph_play_svg__lucide-play"},e),{},{children:(0,m.jsx)("path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"})})),G=e=>(0,m.jsx)("svg",(0,l.A)((0,l.A)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,className:"glyph_shrink_svg__lucide glyph_shrink_svg__lucide-shrink-icon glyph_shrink_svg__lucide-shrink"},e),{},{children:(0,m.jsx)("path",{d:"m15 15 6 6m-6-6v4.8m0-4.8h4.8M9 19.8V15m0 0H4.2M9 15l-6 6M15 4.2V9m0 0h4.8M15 9l6-6M9 4.2V9m0 0H4.2M9 9 3 3"})})),K=e=>(0,m.jsx)("svg",(0,l.A)((0,l.A)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,className:"glyph_movdeDown_svg__lucide glyph_movdeDown_svg__lucide-move-down-icon glyph_movdeDown_svg__lucide-move-down"},e),{},{children:(0,m.jsx)("path",{d:"m8 18 4 4 4-4M12 2v20"})})),q=e=>{let{isOpen:t,onClose:s,currentConfig:a,onApply:o}=e;const{t:i}=(0,n.Bd)("diagnostics"),[h,g]=(0,r.useState)((0,l.A)({},a)),[f,p]=(0,r.useState)({memory:a.memory.toString(),indexedDB:a.indexedDB.toString(),warnThreshold:a.warnThreshold.toString(),autoDisableThreshold:a.autoDisableThreshold.toString()});(0,r.useEffect)((()=>{g((0,l.A)({},a)),p({memory:a.memory.toString(),indexedDB:a.indexedDB.toString(),warnThreshold:a.warnThreshold.toString(),autoDisableThreshold:a.autoDisableThreshold.toString()})}),[a]);const b=()=>{g((0,l.A)({},a)),p({memory:a.memory.toString(),indexedDB:a.indexedDB.toString(),warnThreshold:a.warnThreshold.toString(),autoDisableThreshold:a.autoDisableThreshold.toString()}),s()};return(0,m.jsx)(u.A,{show:t,onLeave:b,children:(0,m.jsx)(c.Ay,{onCancel:b,className:"outline-0",children:(0,m.jsxs)("div",{className:"pa4",children:[(0,m.jsx)("h3",{className:"montserrat fw4 charcoal ma0 f4 mb3",children:i("logs.config.title")}),(0,m.jsxs)("div",{className:"mb4",children:[(0,m.jsxs)("div",{className:"mb3",children:[(0,m.jsx)("label",{htmlFor:"buffer-config-memory",className:"db fw6 mb1 f6 charcoal",children:i("logs.config.memoryBuffer")}),(0,m.jsx)("input",{id:"buffer-config-memory",type:"number",className:"input-reset charcoal ba b--black-20 br1 pa2 w-100 focus-outline",value:f.memory,onChange:e=>{var t;const s=(null===(t=e.target)||void 0===t?void 0:t.value)||"";p((e=>(0,l.A)((0,l.A)({},e),{},{memory:s})))},min:"100",max:"2000"})]}),(0,m.jsxs)("div",{className:"mb3",children:[(0,m.jsx)("label",{htmlFor:"buffer-config-indexeddb",className:"db fw6 mb1 f6 charcoal",children:i("logs.config.persistentBuffer")}),(0,m.jsx)("input",{id:"buffer-config-indexeddb",type:"number",className:"input-reset charcoal ba b--black-20 br1 pa2 w-100 focus-outline",value:f.indexedDB,onChange:e=>{var t;const s=(null===(t=e.target)||void 0===t?void 0:t.value)||"";p((e=>(0,l.A)((0,l.A)({},e),{},{indexedDB:s})))},min:"1000",max:"100000"})]}),(0,m.jsxs)("div",{className:"mb3",children:[(0,m.jsx)("label",{htmlFor:"buffer-config-warn",className:"db fw6 mb1 f6 charcoal",children:i("logs.config.warnThreshold")}),(0,m.jsx)("input",{id:"buffer-config-warn",type:"number",className:"input-reset charcoal ba b--black-20 br1 pa2 w-100 focus-outline",value:f.warnThreshold,onChange:e=>{var t;const s=(null===(t=e.target)||void 0===t?void 0:t.value)||"";p((e=>(0,l.A)((0,l.A)({},e),{},{warnThreshold:s})))},min:"10",max:"1000"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"buffer-config-autodisable",className:"db fw6 mb1 f6 charcoal",children:i("logs.config.autoDisableThreshold")}),(0,m.jsx)("input",{id:"buffer-config-autodisable",type:"number",className:"input-reset charcoal ba b--black-20 br1 pa2 w-100 focus-outline",value:f.autoDisableThreshold,onChange:e=>{var t;const s=(null===(t=e.target)||void 0===t?void 0:t.value)||"";p((e=>(0,l.A)((0,l.A)({},e),{},{autoDisableThreshold:s})))},min:"50",max:"2000"})]})]}),(0,m.jsxs)("div",{className:"flex flex-column flex-row-ns justify-end",children:[(0,m.jsx)(d.A,{id:"buffer-config-cancel-button",minWidth:100,bg:"bg-charcoal",className:"tc",onClick:b,children:i("app:actions.cancel")}),(0,m.jsx)(d.A,{id:"buffer-config-apply-button",minWidth:100,className:"mt2 mt0-ns ml0 ml2-ns tc",onClick:()=>{const e={memory:parseInt(f.memory)||h.memory,indexedDB:parseInt(f.indexedDB)||h.indexedDB,warnThreshold:parseInt(f.warnThreshold)||h.warnThreshold,autoDisableThreshold:parseInt(f.autoDisableThreshold)||h.autoDisableThreshold};o(e),s()},children:i("app:actions.apply")})]})]})})})},$=e=>{switch(e.toLowerCase()){case"debug":return"gray";case"info":return"blue";case"warn":return"orange";case"error":return"red";case"dpanic":case"panic":case"fatal":return"darkred";default:return"black"}},X=e=>{try{return new Date(e).toLocaleTimeString()}catch(t){return e}},J=e=>{let{isExpanded:t,setIsExpanded:s,isStreaming:a,startStreaming:o,stopStreaming:l,onSettingsClick:i,isAtBottom:c,scrollToBottom:u,hasEntries:d,hasInteracted:h,setHasInteracted:g}=e;const{t:f}=(0,n.Bd)("diagnostics"),[p,b]=(0,r.useState)(!0);(0,r.useEffect)((()=>{if(p&&!h){const e=setTimeout((()=>{b(!1)}),6e3);return()=>clearTimeout(e)}}),[p,h]),(0,r.useEffect)((()=>{(a||h)&&b(!1)}),[a,h]),(0,r.useEffect)((()=>{h||b(!0)}),[h]);const x=(0,r.useMemo)((()=>t?G:z),[t]),v=(0,r.useMemo)((()=>a?U:W),[a]),w=(0,r.useCallback)((()=>{g(!0),a?l():o()}),[a,o,l,g]);return(0,m.jsxs)("div",{className:"absolute top-1 right-0 mr3 z-10 flex flex-column flex-start items-end",children:[(0,m.jsx)(F,{text:f(t?"logs.entries.tooltipCollapse":"logs.entries.tooltipExpand"),position:"left",children:(0,m.jsx)(x,{width:32,height:32,className:"pointer gray o-70 hover-o-100 hover-black mb1",onClick:()=>s(!t)})},t?"expanded":"collapsed"),(0,m.jsx)(F,{text:f("logs.entries.tooltipSettings"),position:"left",children:(0,m.jsx)(H,{width:32,height:32,className:"pointer gray o-70 hover-o-100 hover-black mb1 fill-current-color",style:{transformBox:"fill-box",transformOrigin:"center",transform:"scale(1.50)"},onClick:i})}),(0,m.jsx)(F,{text:f(a?"logs.entries.tooltipPause":"logs.entries.tooltipPlay"),position:"left",forceShow:p&&!a&&!d,children:(0,m.jsx)(v,{width:32,height:32,className:"pointer mb1 ".concat(a||d||h?a?"gray breathe hover-black":"gray o-70 hover-o-100 hover-black":"navy-muted pulsate"),onClick:w})}),!c&&(0,m.jsx)(F,{text:f("logs.entries.tooltipGoToLatest"),position:"left",children:(0,m.jsx)(K,{width:32,height:32,className:"pointer gray o-70 hover-o-100 hover-black",onClick:u})})]})},Y=e=>{let{clearEntries:t,onClear:s}=e;const{t:a}=(0,n.Bd)("diagnostics"),o=(0,r.useCallback)((()=>{t(),s()}),[t,s]);return(0,m.jsx)("div",{className:"absolute bottom-1 right-0 mr3 z-10",children:(0,m.jsx)(F,{text:a("logs.storage.trashTooltip"),position:"left",children:(0,m.jsx)(V,{width:32,height:32,className:"pointer gray o-70 hover-o-100 hover-black mb1 fill-current-color",onClick:o})})})},Q="0.3rem",Z=r.memo((e=>{let{logEntry:t}=e;const{timestamp:s,level:r,subsystem:n,message:a,id:o}=t;return(0,m.jsxs)("div",{className:"lh-copy ml2 pb3 mb3 row",children:[(0,m.jsx)("span",{className:"gray f7",title:s,children:X(s)}),(0,m.jsx)("span",{className:"fw6 f7 lvl",style:{color:$(r),whiteSpace:"nowrap"},children:r.toUpperCase()}),(0,m.jsx)("span",{className:"blue f7 sub",style:{whiteSpace:"nowrap"},title:n,children:n}),(0,m.jsx)("span",{className:"f7 pre-wrap mr4 lh-copy msg",style:{lineHeight:"calc(1.5em + ".concat(Q,")")},children:a})]},"".concat(s,"-").concat(n,"-").concat(o))}),((e,t)=>{let{logEntry:{id:s}}=e,{logEntry:{id:r}}=t;return s===r})),ee=e=>{let{logEntries:t,isStreaming:s}=e;const{t:r}=(0,n.Bd)("diagnostics");return 0===t.length?(0,m.jsx)("div",{className:"mv4 tc charcoal-muted f5",children:(0,m.jsx)("p",{className:"ma0 sans-serif",children:r(s?"logs.entries.noEntriesStreaming":"logs.entries.noEntries")})}):(0,m.jsx)("div",{className:"logs pv2",style:{rowGap:"calc(1.5 * ".concat(Q,")")},children:t.map((e=>(0,m.jsx)(Z,{logEntry:e},e.id)))})},te=e=>{let{logEntries:t,isStreaming:s,containerRef:n,style:a,startStreaming:o,stopStreaming:i,clearEntries:c}=e;const[u,d]=(0,r.useState)(!1),[h,g]=(0,r.useState)(!0),[f,p]=(0,r.useState)(!1),[b,x]=(0,r.useState)(!1),v=(0,r.useMemo)((()=>{var e;return null===(e=t[t.length-1])||void 0===e?void 0:e.id}),[t]),{bufferConfig:w,updateBufferConfig:y}=I(),j=(0,r.useCallback)((e=>{const t=e.currentTarget,s=t.scrollTop,r=t.scrollHeight,n=t.clientHeight;g(s+n>=r-50)}),[]),A=(0,r.useCallback)((()=>{n.current&&(n.current.scrollTop=n.current.scrollHeight)}),[n]);(0,r.useEffect)((()=>{h&&A()}),[h,A,v]);const S=(0,r.useCallback)((()=>{s&&i(),x(!1)}),[s,i]),C=(0,r.useMemo)((()=>{const e=(0,l.A)({},a);return u?(0,l.A)({height:"90vh",width:"90vw",position:"fixed",inset:"5%",zIndex:1e3,display:"flex",flexDirection:"column"},e):(0,l.A)({height:"100%",display:"flex",flexDirection:"column"},e)}),[a,u]);return(0,m.jsxs)(m.Fragment,{children:[u&&(0,m.jsx)("div",{className:"fixed top-0 left-0 right-0 bottom-0",style:{backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",backgroundColor:"rgba(255, 255, 255, 0.7)",zIndex:999},role:"button",tabIndex:0,"aria-label":"Click to collapse log viewer",onClick:()=>d(!1),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||d(!1)}}),(0,m.jsxs)("div",{className:"relative code",style:C,children:[(0,m.jsx)(J,{isExpanded:u,setIsExpanded:d,isStreaming:s,startStreaming:o,stopStreaming:i,onSettingsClick:()=>p(!0),isAtBottom:h,scrollToBottom:A,hasEntries:t.length>0,hasInteracted:b,setHasInteracted:x}),(0,m.jsxs)("div",{ref:n,className:"ba b--black-20 bg-near-white f6 overflow-auto overflow-x-hidden flex-auto",style:{minHeight:0},onScroll:j,children:[(0,m.jsx)(ee,{logEntries:t,isStreaming:s}),(0,m.jsx)(Y,{clearEntries:c,onClear:S})]}),(0,m.jsx)(q,{isOpen:f,onClose:()=>p(!1),currentConfig:w,onApply:y})]})]})};var se=s(41684);const re=e=>{let{className:t}=e;const{t:s}=(0,n.Bd)("diagnostics"),{isStreaming:a,rateState:o,bufferConfig:l}=I(),i=(0,r.useMemo)((()=>s(a?"logs.streaming.statusActive":"logs.streaming.statusStopped")),[a,s]),c=(0,r.useMemo)((()=>a?"green":"red-muted"),[a]),u=(0,r.useMemo)((()=>o.currentRate>l.warnThreshold?(0,m.jsx)("span",{className:"yellow f7",children:s("logs.streaming.highRate")}):null),[o.currentRate,l.warnThreshold,s]),d=(0,r.useMemo)((()=>o.autoDisabled?(0,m.jsx)("span",{className:"ml2 red f7",children:s("logs.streaming.autoDisabled")}):null),[o.autoDisabled,s]);return(0,m.jsxs)("div",{className:"flex items-center lh-solid ".concat(t),children:[(0,m.jsx)("span",{className:"".concat(c," f7 mr2"),children:i}),(0,m.jsx)("span",{className:"charcoal f7",children:s("logs.streaming.rate",{rate:o.currentRate.toFixed(1)})}),u,d]})},ne=()=>{const{t:e}=(0,n.Bd)("diagnostics"),{bufferConfig:t,storageStats:s,entries:r}=I();return s?(0,m.jsx)("div",{className:"pt0",children:(0,m.jsxs)("div",{className:"statsBar flex items-center justify-between code",children:[(0,m.jsxs)("div",{className:"flex items-center",children:[(0,m.jsxs)("h4",{className:"montserrat fw6 charcoal ma0 f7 mr2",children:[e("logs.storage.title"),":"]}),(0,m.jsxs)("span",{className:"charcoal f7 mr3",children:[e("logs.storage.totalEntries"),": ",s.totalEntries.toLocaleString()]}),(0,m.jsxs)("span",{className:"charcoal f7 mr3",children:[e("logs.storage.estimatedSize"),": ",(0,se.Xe)(s.estimatedSize)]}),(0,m.jsxs)("span",{className:"charcoal f7",children:[e("logs.storage.memoryBuffer"),": ",r.length,"/",t.memory]})]}),(0,m.jsx)(re,{})]})}):null},ae=()=>{const{entries:e,isStreaming:t,bufferConfig:s,rateState:n,setLogLevelsBatch:a,startStreaming:o,stopStreaming:l,clearEntries:c,showWarning:u,isAgentVersionSupported:d}=I(),[g,f]=(0,r.useState)({isOpen:!1,type:null}),[p,b]=(0,r.useState)(null),x=(0,r.useRef)(null);(0,r.useEffect)((()=>{n.currentRate>s.warnThreshold&&!n.hasWarned&&!n.autoDisabled&&t&&(f({isOpen:!0,type:"high-rate"}),u())}),[n,s,t,u]),(0,r.useEffect)((()=>{n.autoDisabled&&f({isOpen:!0,type:"auto-disable"})}),[n.autoDisabled]);return d?(0,m.jsxs)("div",{className:"logs-screen-container",children:[(0,m.jsx)(M,{}),(0,m.jsx)(i.A,{className:"",style:{flex:"1 1 auto",minHeight:"15rem",display:"flex",flexDirection:"column"},children:(0,m.jsx)(te,{logEntries:e,isStreaming:t,containerRef:x,startStreaming:o,stopStreaming:l,clearEntries:c})}),(0,m.jsx)(ne,{}),(0,m.jsx)(h,{isOpen:g.isOpen,warningType:g.type,currentRate:n.currentRate,onClose:()=>f({isOpen:!1,type:null}),onConfirm:async()=>{if(p)try{await a([{subsystem:p.subsystem,level:p.level}]),b(null)}catch(e){console.error("Failed to set log level:",e)}}})]}):(0,m.jsx)(B,{})};var oe=s(13026);var le=s(10555);const ie=(0,oe.N)("selectIpfsCheckUrl",(e=>{let{cid:t,ipfsCheckUrl:s}=e;const n=s||le.i_,a=n.endsWith("/")?n:"".concat(n,"/"),o=new URL(a).origin,l=(0,r.useRef)(null),[i,c]=(0,r.useState)(!0),u=((e,t)=>{const s=(0,r.useRef)(void 0),n=(0,r.useRef)(null),a=(0,r.useRef)(null);return(0,r.useEffect)((()=>()=>{clearTimeout(s.current)}),[]),(0,r.useEffect)((()=>{clearTimeout(s.current),s.current=void 0}),[e]),(0,r.useEffect)((()=>{if(s.current&&n.current&&null!=a.current){const r=a.current,o=Date.now()-n.current,l=Math.max(0,t-o);if(l<=0)return void e(...r);clearTimeout(s.current),s.current=setTimeout((()=>{e(...r)}),l)}}),[t]),(0,r.useCallback)((function(){for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];n.current=Date.now(),a.current=o,clearTimeout(s.current),s.current=setTimeout((()=>{e(...o)}),t)}),[e,t])})((()=>{const e=l.current;null!==e&&void 0!==e&&e.contentWindow&&e.contentWindow.postMessage({type:"iframe-size:request"},o)}),100);(0,r.useEffect)((()=>{const e=l.current;if(!e)return;const t=t=>{var s;t.origin===o&&"iframe-size:report"===(null===(s=t.data)||void 0===s?void 0:s.type)&&(c(!1),e.style.height="".concat(t.data.height,"px"))},s=()=>{c(!1),u()};return window.addEventListener("message",t),window.addEventListener("resize",u),e.addEventListener("load",s),u(),()=>{window.removeEventListener("message",t),window.removeEventListener("resize",u),e.removeEventListener("load",s)}}),[u,o]);const d=t?"".concat(a,"?cid=").concat(encodeURIComponent(t)):a;return(0,m.jsxs)("div",{className:"relative",children:[i&&(0,m.jsx)("div",{className:"absolute w-100 mt4 tc charcoal-muted f5 z-1",role:"status","aria-live":"polite",children:(0,m.jsx)("p",{className:"ma0 sans-serif",children:"Loading retrieval check..."})}),(0,m.jsx)("iframe",{ref:l,className:"db bn w-100 overflow-y-hidden overflow-x-hidden",style:{height:"80vh"},title:"ipfs-check @ ".concat(a),src:d,"aria-busy":i,sandbox:"allow-scripts allow-forms allow-same-origin"})]})}));const ce=e=>{let{tabKey:t,label:s,active:r}=e;return(0,m.jsx)("a",{href:"#/diagnostics/".concat(t),className:"pv2 ph3 mr2 br2 pointer fw5 no-underline transition-all ".concat(r?"bg-teal white":"bg-transparent charcoal-muted hover-bg-gray-muted hover-charcoal"),style:(0,l.A)({transition:"all 0.2s ease"},r&&{backgroundColor:"#378085",color:"white"}),children:s},t)},ue=()=>{var e;const{t:t}=(0,n.Bd)("diagnostics"),s=(0,C.O0)("selectRouteInfo"),a=null!==(e=null===s||void 0===s?void 0:s.params.path)&&void 0!==e?e:"",{tab:o,remainder:l}=function(e){const t=e.split("/").filter((e=>e));return 0===t.length?{tab:"logs"}:{tab:t[0],remainder:t.slice(1).join("/")||void 0}}(a);(0,r.useEffect)((()=>{if(!s)return;!("/diagnostics"===s.url||"/diagnostics/"===s.url)||""!==a&&"/"!==a||window.location.replace("#/diagnostics/logs")}),[a,s]);const i=(0,r.useRef)(!1);(0,r.useEffect)((()=>(i.current=!0,()=>{i.current=!1})),[]);return(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"mb4 pb2",style:{borderBottom:"1px solid #e1e5eb"},children:(0,m.jsxs)("nav",{className:"flex items-center",children:[(0,m.jsx)(ce,{tabKey:"logs",label:t("tabs.logs"),active:"logs"===o}),(0,m.jsx)(ce,{tabKey:"retrieval-check",label:t("tabs.retrieval-check"),active:"retrieval-check"===o})]})}),(()=>{switch(o){case"logs":return(0,m.jsx)(_.U,{children:(0,m.jsx)(R,{children:(0,m.jsx)(ae,{})})});case"retrieval-check":return(0,m.jsx)(ie,{cid:l});default:return null}})()]})},de=()=>{const{t:e}=(0,n.Bd)("diagnostics"),t=(0,C.O0)("selectIpfsConnected"),s=(0,r.useMemo)((()=>t?ue:o.A),[t]);return(0,m.jsxs)("div",{"data-id":"DiagnosticsPage",className:"mw9 center",children:[(0,m.jsx)(a.mg,{children:(0,m.jsxs)("title",{children:[e("title")," | IPFS"]})}),(0,m.jsx)("div",{className:"flex",children:(0,m.jsx)("div",{className:"flex-auto",children:(0,m.jsx)(s,{},t?"connected":"not-connected")})})]})}}}]);
//# sourceMappingURL=701.b4fca0f3.chunk.js.map